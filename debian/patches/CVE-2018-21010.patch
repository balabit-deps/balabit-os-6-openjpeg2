Description: color_apply_icc_profile: avoid potential heap buffer overflow 
 This patch addresses CVE-2018-21010. It differs slightly from upstream's
 patch in that we avoid whitespace refactoring and complex nested ifs.
Author: Even Rouault <even.rouault@spatialys.com>, Hugo Lefeuvre <hle@debian.org>
Origin: upstream, https://github.com/uclouvain/openjpeg/commit/2e5ab1d9987831c9
--- a/src/bin/common/color.c	2019-10-08 15:26:20.349834699 +0200
+++ b/src/bin/common/color.c	2019-10-08 15:28:25.492050700 +0200
@@ -496,6 +496,18 @@
 
 	if(image->numcomps > 2)/* RGB, RGBA */
 	{
+
+		if (!(image->comps[0].w == image->comps[1].w &&
+		      image->comps[0].w == image->comps[2].w) ||
+		    !(image->comps[0].h == image->comps[1].h &&
+		      image->comps[0].h == image->comps[2].h))
+		{
+			fprintf(stderr,
+			"[ERROR] Image components should have the same width and height\n");
+			cmsDeleteTransform(transform);
+			return;
+		}
+
 		if( prec <= 8 )
 		{
 			unsigned char *inbuf, *outbuf, *in, *out;
