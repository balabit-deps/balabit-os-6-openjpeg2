Description: Fix incrementing of "l_tcp->m_nb_mcc_records" in opj_j2k_read_mcc
Origin: upstream, https://github.com/uclouvain/openjpeg/pull/820/commits/e9606c02c148e410305bf959a51baab24aa88cd7
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
Index: openjpeg2-2.1.0/src/lib/openjp2/j2k.c
===================================================================
--- openjpeg2-2.1.0.orig/src/lib/openjp2/j2k.c
+++ openjpeg2-2.1.0/src/lib/openjp2/j2k.c
@@ -5308,6 +5308,7 @@ OPJ_BOOL opj_j2k_read_mcc (     opj_j2k_
         OPJ_UINT32 l_nb_collections;
         OPJ_UINT32 l_nb_comps;
         OPJ_UINT32 l_nb_bytes_by_comp;
+	OPJ_BOOL l_new_mcc = OPJ_FALSE;
 
         /* preconditions */
         assert(p_header_data != 00);
@@ -5369,6 +5370,7 @@ OPJ_BOOL opj_j2k_read_mcc (     opj_j2k_
                         memset(l_mcc_record,0,(l_tcp->m_nb_max_mcc_records-l_tcp->m_nb_mcc_records) * sizeof(opj_simple_mcc_decorrelation_data_t));
                 }
                 l_mcc_record = l_tcp->m_mcc_records + l_tcp->m_nb_mcc_records;
+		l_new_mcc = OPJ_TRUE;
         }
         l_mcc_record->m_index = l_indix;
 
@@ -5504,7 +5506,9 @@ OPJ_BOOL opj_j2k_read_mcc (     opj_j2k_
                 return OPJ_FALSE;
         }
 
-        ++l_tcp->m_nb_mcc_records;
+        if (l_new_mcc) {
+                ++l_tcp->m_nb_mcc_records;
+        }
 
         return OPJ_TRUE;
 }
